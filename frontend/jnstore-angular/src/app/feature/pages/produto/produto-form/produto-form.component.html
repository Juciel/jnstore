<div class="produto-form container py-3">

    <div class="d-flex justify-content-between align-items-center mb-2">
      <a class="btn btn-secondary" routerLink="/produtos">&larr; Voltar</a>
      <div *ngIf="loadingCategorias" class="alert alert-info mb-0">Carregando categorias...</div>
    </div>
    <div *ngIf="categoriasError" class="alert alert-danger">{{ categoriasError }}</div>
  <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
    <div class="mb-3">
      <label class="form-label">Nome</label>
      <input class="form-control" [class.is-invalid]="form.get('nome')?.invalid && form.get('nome')?.touched" formControlName="nome" maxlength="100"/>
      <div *ngIf="form.get('nome')?.invalid && form.get('nome')?.touched" class="invalid-feedback">Nome é obrigatório.</div>
    </div>

    <div class="mb-3">
      <label class="form-label">Descrição</label>
      <input class="form-control" formControlName="descricao" maxlength="200"/>
    </div>

    <div class="mb-3">
      <label class="form-label">Preço de Compra</label>
      <input type="text" class="form-control" currencyMask inputmode="decimal" [class.is-invalid]="form.get('valorCompra')?.invalid && form.get('valorCompra')?.touched" formControlName="valorCompra" />
      <div *ngIf="form.get('valorCompra')?.invalid && form.get('valorCompra')?.touched" class="invalid-feedback">Informe o preço de compra.</div>
    </div>

    <div class="mb-3">
      <label class="form-label">Preço de Venda</label>
      <input type="text" class="form-control" currencyMask inputmode="decimal" [class.is-invalid]="form.get('valorVenda')?.invalid && form.get('valorVenda')?.touched" formControlName="valorVenda" />
      <div *ngIf="form.get('valorVenda')?.invalid && form.get('valorVenda')?.touched" class="invalid-feedback">Informe o preço de venda.</div>
    </div>

    <div class="row">
      <div class="mb-3 col-md-6">
        <label class="form-label">Categoria</label>
        <select class="form-select" formControlName="categoriaId">
          <option value="">-- selecione --</option>
          <option *ngFor="let c of categorias" [value]="c.id">{{ c.descricao }}</option>
        </select>
      </div>
      <div class="mb-3 col-md-6">
        <label class="form-label">Gênero</label>
        <select class="form-select" formControlName="genero">
          <option value="">-- selecione --</option>
          <option value="MASCULINO">Masculino</option>
          <option value="FEMININO">Feminino</option>
          <option value="UNISSEX">Unissex</option>
        </select>
      </div>
    </div>

    <app-variacao-tabela
      [parentForm]="form"
      [variacoes]="variacoes"
      (add)="openVariacaoModal()"
      (edit)="openVariacaoModal($event)"
      (remove)="removeVariacao($event)">
    </app-variacao-tabela>

    <div class="mb-3">
      <button type="submit" class="btn btn-primary" [disabled]="form.invalid || saving">{{ saving ? 'Salvando...' : 'Salvar Produto' }}</button>
    </div>
  </form>
  <app-variacao-modal (save)="onVariacaoSave($event)"></app-variacao-modal>

  <div *ngIf="saveError" class="alert alert-danger">{{ saveError }}</div>
</div>
